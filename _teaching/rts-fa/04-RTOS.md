---
title: "مدیریت تسک‌ها و حافظه در سیستم‌عامل‌های بلادرنگ"
collection: teaching
type: "Course Module"
permalink: /teaching/rts-fa/task-management
course: "سیستم‌های بلادرنگ"
order: 3
mathjax: true
use_math: true
layout: courserst
lang: fa
alt_lang: en
alt_url: /teaching/rts/task-management
---

# مدیریت تسک‌ها و حافظه در سیستم‌عامل‌های بلادرنگ

در سیستم‌عامل‌های بلادرنگ (RTOS)، **تسک (Task)** به مجموعه‌ای از دستورات گفته می‌شود که می‌تواند روی یک پردازنده اجرا شود. هر تسک برای اجرا باید با سایر تسک‌ها رقابت کند و سیستم‌عامل مسئول **زمان‌بندی، اولویت‌بندی و مدیریت منابع** است.  

---

## تسک (Task) در سیستم‌عامل بلادرنگ

- یک تسک **قابل زمان‌بندی (Schedulable)** است.  
- هر تسک دارای **اولویت مشخص** است.  
- برای هر تسک یک فضای پشته (Stack) و مجموعه‌ای از **رجیسترهای CPU** در نظر گرفته می‌شود.  

---

## مدل بلاک کنترلی تسک (Task Control Block - TCB)

یکی از معروف‌ترین رویکردها برای مدیریت تسک‌ها در RTOS استفاده از **مدل بلاک کنترلی تسک** یا **TCB** است.  

- TCB یک **ساختمان داده خصوصی** برای هر تسک است.  
- سیستم‌عامل لیستی از TCBها را نگهداری می‌کند (معمولاً به صورت لیست پیوندی).  
- اطلاعاتی مثل وضعیت تسک، اشاره‌گر به پشته، رجیسترها و اولویت در TCB ذخیره می‌شود.  

---

## ارتباط و همگام‌سازی بین تسک‌ها

سیستم‌عامل‌های بلادرنگ برای اجرای درست و منظم تسک‌ها، از مکانیزم‌های مختلفی برای **ارتباط (Communication)** و **همگام‌سازی (Synchronization)** بین تسک‌ها استفاده می‌کنند:

### ۱. بافرها (Buffers)

- **بافرهای دوگانه (Double Buffering):**  
  دو بافر مجزا وجود دارد؛ یکی پر می‌شود و دیگری همزمان خالی. سوییچ بین آن‌ها می‌تواند سخت‌افزاری یا نرم‌افزاری باشد.  

- **بافر خطی مشترک (Shared Linear Buffer):**  
  شامل مشکل معروف **خوانندگان–نویسندگان** (Readers-Writers Problem) است، جایی که چند نویسنده و چند خواننده به یک بافر محدود دسترسی دارند.  

- **بافر حلقه‌ای (Circular Buffer):**  
  داده‌ها در انتهای بافر نوشته و از ابتدای آن خوانده می‌شوند.  
  اگر شاخص ابتدا و انتها برابر نباشد، می‌توان همزمان عملیات خواندن و نوشتن را انجام داد.  

---

### ۲. Mailbox  

- Mailbox یک فضای خاص از حافظه است که یک یا چند تسک می‌توانند برای **انتقال داده یا همگام‌سازی** از آن استفاده کنند.  
- دسترسی به Mailbox باید **انحصاری (Mutual Exclusion)** باشد.  
- تسک‌ها در صورت اشغال بودن باید منتظر بمانند.  
- دو عملیات اصلی:  
  - `pend(data, &s)` → دریافت داده و قفل‌گذاری  
  - `post(data, &s)` → ارسال داده و آزادسازی  

---

### ۳. سمافور (Semaphore)

- یکی از پرکاربردترین مکانیزم‌ها برای حفاظت از **بخش‌های بحرانی** و منابع مشترک است.  
- **سمافور باینری** مثل یک کلید قفل/باز عمل می‌کند.  
- دو عملیات اصلی روی سمافور:  
  - `wait` → درخواست دسترسی و قفل کردن  
  - `signal` → آزادسازی منبع  

---

## مدیریت حافظه در RTOS

### ۱. Context Switch  

در سیستم‌های چندوظیفه‌ای (Multitasking)، سیستم‌عامل باید بتواند بین تسک‌ها **تعویض متن (Context Switching)** انجام دهد.  

- Context هر تسک شامل رجیسترها، پشته و وضعیت اجراست.  
- هنگام سوییچ، اطلاعات تسک جاری ذخیره و اطلاعات تسک بعدی بارگذاری می‌شود.  

### ۲. نقش TCB در مدیریت حافظه  

- در مدل TCB، لیستی از **TCBها** نگهداری می‌شود (به صورت ثابت یا پویا).  
- هر TCB شامل اشاره‌گر به پشته مربوط به تسک است.  
- **پشته‌ها باید متناسب با اولویت‌ها و نیازهای سیستم تعریف شوند.**  

---

## نکات کلیدی

- هر تسک یک **واحد مستقل قابل زمان‌بندی** است.  
- **TCB** هسته مدیریت تسک‌ها در سیستم‌عامل‌های بلادرنگ است.  
- ارتباط بین تسک‌ها می‌تواند با **بافرها، Mailbox و سمافورها** انجام شود.  
- مدیریت حافظه و **Context Switching** نقش حیاتی در عملکرد RTOS دارد.  

---

<div class="lesson-nav" style="display:flex; justify-content:space-between; margin-top:2em;">
  <a class="btn btn--primary" href="{{ '/teaching/rts-fa/real-time-os' | relative_url }}">⬅︎ قبلی: سیستم‌عامل‌های بلادرنگ</a>
</div>

<div class="lesson-nav" style="display:flex; justify-content:space-between; margin-top:2em;">
  <a class="btn btn--primary" href="{{ '/teaching/rts-fa/scheduling' | relative_url }}">بعدی: زمان‌بندی در سیستم‌های بلادرنگ ➡︎</a>
</div>
